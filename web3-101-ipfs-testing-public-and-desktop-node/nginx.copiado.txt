


server {
    server_name gateway.ipfs.io;
    access_log /var/log/nginx/access.log mtail;

    listen 443 default_server ssl;
    listen [::]:443 default_server ssl;
    ssl_certificate /etc/nginx/certs/ipfs.io.crt;
    ssl_certificate_key /etc/nginx/certs/ipfs.io.key;
    ssl_dhparam /etc/nginx/certs/dhparam.pem;
    ssl_trusted_certificate /etc/nginx/certs/ipfs.io.trustchain.crt;

    # HSTS (ngx_http_headers_module is required)
    # 31536000 seconds = 12 months, as advised by hstspreload.org
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'X-Requested-With, Range, Content-Range, X-Chunked-Output, X-Stream-Output' always;
    add_header 'Access-Control-Expose-Headers' 'Content-Range, X-Chunked-Output, X-Stream-Output' always;

    include conf.d/gateway/denylist.conf;

    proxy_pass_header Server;
    proxy_read_timeout 1800s;

    location / {
        proxy_set_header Host \$host;
        proxy_set_header X-Ipfs-Gateway-Prefix "";
        proxy_pass http://gateway;
    }
}





SUBDOMINIO:

server {
    server_name *.i.ipfs.io;

    listen 443 ssl;
    listen [::]:443 ssl;
    ssl_certificate /etc/nginx/certs/i.ipfs.io.crt;
    ssl_certificate_key /etc/nginx/certs/i.ipfs.io.key;
    ssl_dhparam /etc/nginx/certs/i.ipfs.io.dhparam.pem;
    ssl_trusted_certificate /etc/nginx/certs/i.ipfs.io.trustchain.crt;

    # HSTS (ngx_http_headers_module is required)
    # 31536000 seconds = 12 months, as advised by hstspreload.org
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'X-Requested-With, Range, Content-Range, X-Chunked-Output, X-Stream-Output' always;
    add_header 'Access-Control-Expose-Headers' 'Content-Range, X-Chunked-Output, X-Stream-Output' always;

    location / {
        proxy_set_header Host "";
        # The gateway upstream is defined in the gateway.conf.
        proxy_pass http://gateway;
        proxy_pass_header Server;
        proxy_read_timeout 60s;
    }
}

